<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Axis Estate - Financial Dashboard</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load React & ReactDOM (Version 18) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Load Dependencies for Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- 4. Load Recharts -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    
    <!-- 5. Load Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        body {
            font-family: 'Sarabun', sans-serif, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, AreaChart, Area
        } = Recharts;

        // Icons
        const IconActivity = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const IconHome = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const IconUsers = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const IconFileText = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const IconPieChart = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>;
        const IconTable = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>;
        const IconRefreshCw = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const IconTrendingUp = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const IconBuilding2 = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>;
        const IconSettings = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconClock = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconToggleLeft = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="8" cy="12" r="2"/></svg>;
        const IconToggleRight = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="16" cy="12" r="2"/></svg>;
        const IconBriefcase = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>;
        const IconGrowth = ({ className, size = 24 }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m2 17 8.5-8.5 5 5L22 3"/><path d="M22 3h-6"/><path d="M22 3v6"/></svg>;

        const FinancialDashboard = () => {
            // --- 1. State Configuration ---
            const [inputs, setInputs] = useState({
                // Parameters
                vatMode: 'include',
                growthRate: 0, 
                annualGrowthRate: 15, 

                // CAPEX
                initialCapital: 2000000,
                capexRegistration: 20000,
                capexOffice: 120000,
                capexEquipment: 100000,
                capexTech: 60000,
                capexLaunch: 50000,

                // Revenue Drivers
                avgHousePrice: 7000000,       
                salesVolume: 3,               
                salesCommRate: 5,             
                rentalVolume: 7,              
                avgRentalPrice: 50000,        
                rentalCommMonths: 1,          

                // Costs
                marketingBudget: 100000,      
                officeRent: 35000,            
                softwareCost: 10000,          
                otherExpenses: 0, 

                // Salaries
                salaryManagerRate: 30000, salaryManagerCount: 1,
                salarySalesRate: 18000,   salarySalesCount: 2,
                salaryAdminRate: 15000,   salaryAdminCount: 1,
                salaryListingRate: 15000, salaryListingCount: 1,
                salaryContentRate: 15000, salaryContentCount: 1,

                // Sharing %
                shareSales: 30,
                shareListing: 2.5,
                shareAdmin: 2.5,
                shareManager: 0,
                shareContent: 0,
            });

            const [results, setResults] = useState({
                totalCapex: 0,
                workingCapital: 0,
                totalGross: 0,
                vatAmount: 0,
                netRevenue: 0,
                distSales: 0,
                distListing: 0,
                distAdmin: 0,
                distManager: 0,
                distContent: 0,
                distCompany: 0,
                companySharePercent: 0,
                totalExpenses: 0,
                annualNetProfit: 0,
                roi: 0,
                paybackPeriod: 0,
                breakEvenPoint: 0,
                taxDetails: [],
                totalTax: 0,
                monthlyEBT: 0,
                annualEBT: 0,
                totalSalaries: 0,
                year1RevenueSum: 0,
                year1ExpenseSum: 0,
                finalCashBalance: 0
            });

            const [cashFlowData, setCashFlowData] = useState([]);
            const [fiveYearData, setFiveYearData] = useState([]);
            const [expensePieData, setExpensePieData] = useState([]);
            const [revenuePieData, setRevenuePieData] = useState([]);

            const calculateTax = (annualEBT) => {
                let tax = 0;
                if (annualEBT > 3000000) {
                    tax += (annualEBT - 3000000) * 0.20;
                    tax += 2700000 * 0.15;
                } else if (annualEBT > 300000) {
                    tax += (annualEBT - 300000) * 0.15;
                }
                return tax;
            }

            // --- 2. Calculation Logic ---
            useEffect(() => {
                // A. CAPEX Calculation
                const totalCapex = inputs.capexRegistration + inputs.capexOffice + inputs.capexEquipment + inputs.capexTech + inputs.capexLaunch;
                const workingCapital = inputs.initialCapital - totalCapex;

                // B. Base Revenue (Month 1 Snapshot)
                const salesBase = inputs.avgHousePrice * inputs.salesVolume * (inputs.salesCommRate / 100);
                const rentalBase = inputs.avgRentalPrice * inputs.rentalVolume * inputs.rentalCommMonths;
                const baseRevenue = salesBase + rentalBase;

                // C. VAT Logic (Month 1)
                let totalGross, netRevenue, vatAmount;
                let salesNet, rentalNet;

                if (inputs.vatMode === 'include') {
                    totalGross = baseRevenue; 
                    netRevenue = totalGross / 1.07;
                    vatAmount = totalGross - netRevenue;
                    salesNet = salesBase / 1.07;
                    rentalNet = rentalBase / 1.07;
                } else {
                    netRevenue = baseRevenue;
                    vatAmount = netRevenue * 0.07;
                    totalGross = netRevenue + vatAmount;
                    salesNet = salesBase;
                    rentalNet = rentalBase;
                }

                // D. Commission Distribution (Month 1)
                const distSales = netRevenue * (inputs.shareSales / 100);
                const distListing = netRevenue * (inputs.shareListing / 100);
                const distAdmin = netRevenue * (inputs.shareAdmin / 100);
                const distManager = netRevenue * (inputs.shareManager / 100);
                const distContent = netRevenue * (inputs.shareContent / 100);
                
                const companySharePercent = 100 - inputs.shareSales - inputs.shareListing - inputs.shareAdmin - inputs.shareManager - inputs.shareContent;
                const distCompany = netRevenue * (companySharePercent / 100);

                // Pie Chart Revenue: Company Net Share (Month 1)
                const salesCompanyIncome = salesNet * (companySharePercent / 100);
                const rentalCompanyIncome = rentalNet * (companySharePercent / 100);

                // E. Expenses (Fixed + Marketing)
                const totalSalaries = 
                    (inputs.salaryManagerRate * inputs.salaryManagerCount) +
                    (inputs.salarySalesRate * inputs.salarySalesCount) +
                    (inputs.salaryAdminRate * inputs.salaryAdminCount) +
                    (inputs.salaryListingRate * inputs.salaryListingCount) +
                    (inputs.salaryContentRate * inputs.salaryContentCount);

                const fixedCosts = totalSalaries + inputs.officeRent + inputs.softwareCost + inputs.otherExpenses;
                const totalExpenses = fixedCosts + inputs.marketingBudget;

                // F. Profit (Month 1)
                const monthlyEBT = distCompany - totalExpenses;

                // --- 12-MONTH SIMULATION (With Monthly Growth Rate) ---
                const cfData = [];
                let currentCash = workingCapital; 
                let cumulativeEBT = 0;
                let year1RevenueSum = 0;
                let year1ExpenseSum = 0;

                for (let i = 1; i <= 12; i++) {
                    const growthFactor = Math.pow(1 + (inputs.growthRate / 100), i - 1);
                    const currentSalesVol = inputs.salesVolume * growthFactor;

                    const mSalesBase = inputs.avgHousePrice * currentSalesVol * (inputs.salesCommRate / 100);
                    const mRentalBase = rentalBase; 
                    const mBaseRevenue = mSalesBase + mRentalBase;

                    let mNetRevenue;
                    if (inputs.vatMode === 'include') {
                        mNetRevenue = mBaseRevenue / 1.07;
                    } else {
                        mNetRevenue = mBaseRevenue;
                    }

                    const mDistCompany = mNetRevenue * (companySharePercent / 100);
                    const mFlow = mDistCompany - totalExpenses;

                    year1RevenueSum += mDistCompany;
                    year1ExpenseSum += totalExpenses;
                    cumulativeEBT += mFlow;
                    
                    // Monthly cash flow adds EBT (Not deducting tax yet)
                    currentCash += mFlow;

                    cfData.push({
                        month: i,
                        revenue: mDistCompany,
                        expenses: totalExpenses,
                        net: mFlow, // Operating Profit
                        cumulative: currentCash // Pre-tax Cash
                    });
                }

                // G. Annual Tax (Year 1)
                const annualEBT = cumulativeEBT;
                let tax = calculateTax(annualEBT);
                
                // Final Cash after tax (End of Year 1)
                const finalCashBalance = currentCash - tax;

                const annualNetProfit = annualEBT - tax;
                const roi = (annualNetProfit / inputs.initialCapital) * 100;
                
                let paybackPeriod = Infinity;
                if (annualNetProfit > 0) {
                    paybackPeriod = inputs.initialCapital / (annualNetProfit / 12);
                }

                // H. Break Even
                let breakEvenRevenue = 0;
                if (companySharePercent > 0) {
                    const netRevenueNeeded = totalExpenses / (companySharePercent / 100);
                    if (inputs.vatMode === 'include') {
                        breakEvenRevenue = netRevenueNeeded * 1.07;
                    } else {
                        breakEvenRevenue = netRevenueNeeded; 
                    }
                }

                // --- 5-YEAR PROJECTION LOGIC ---
                const fiveYear = [];
                let prevYearCash = finalCashBalance; // Start Year 2 with Year 1 Post-Tax Cash
                let prevRevenue = year1RevenueSum;
                let prevExpenses = year1ExpenseSum;

                // Year 1 (Calculated above)
                fiveYear.push({
                    year: 1,
                    revenue: year1RevenueSum,
                    expenses: year1ExpenseSum,
                    ebt: annualEBT,
                    tax: tax,
                    netProfit: annualNetProfit,
                    cashEnd: finalCashBalance
                });

                // Year 2-5 Loop
                const annualGrowth = inputs.annualGrowthRate / 100;
                const inflationRate = 0.05; // 5% expense increase per year

                for (let y = 2; y <= 5; y++) {
                    const rev = prevRevenue * (1 + annualGrowth);
                    const exp = prevExpenses * (1 + inflationRate);
                    const ebt = rev - exp;
                    const yTax = calculateTax(ebt);
                    const net = ebt - yTax;
                    const cash = prevYearCash + net;

                    fiveYear.push({
                        year: y,
                        revenue: rev,
                        expenses: exp,
                        ebt: ebt,
                        tax: yTax,
                        netProfit: net,
                        cashEnd: cash
                    });

                    prevRevenue = rev;
                    prevExpenses = exp;
                    prevYearCash = cash;
                }
                setFiveYearData(fiveYear);

                // Tax Details for display (Year 1)
                let taxDetails = [];
                let t1Base = Math.min(annualEBT, 300000); if(t1Base<0) t1Base=0;
                taxDetails.push({ tier: '0 - 300,000', rate: '0%', base: t1Base, tax: 0 });
                let t2Base = 0, t2Tax = 0;
                if (annualEBT > 300000) { t2Base = Math.min(annualEBT - 300000, 2700000); t2Tax = t2Base * 0.15; }
                taxDetails.push({ tier: '300,001 - 3M', rate: '15%', base: t2Base, tax: t2Tax });
                let t3Base = 0, t3Tax = 0;
                if (annualEBT > 3000000) { t3Base = annualEBT - 3000000; t3Tax = t3Base * 0.20; }
                taxDetails.push({ tier: '> 3,000,000', rate: '20%', base: t3Base, tax: t3Tax });

                setResults({
                    totalCapex, workingCapital,
                    totalGross, vatAmount, netRevenue,
                    distSales, distListing, distAdmin, distManager, distContent, distCompany, companySharePercent,
                    totalExpenses, annualNetProfit, roi, paybackPeriod, breakEvenPoint: breakEvenRevenue,
                    taxDetails, totalTax: tax, monthlyEBT, annualEBT, totalSalaries,
                    year1RevenueSum, year1ExpenseSum, finalCashBalance
                });

                setCashFlowData(cfData);

                // Pie Data - Expense
                setExpensePieData([
                    { name: 'เงินเดือน', value: totalSalaries },
                    { name: 'การตลาด', value: inputs.marketingBudget },
                    { name: 'ค่าเช่าออฟฟิศ', value: inputs.officeRent },
                    { name: 'อื่นๆ/Soft', value: inputs.softwareCost + inputs.otherExpenses },
                ]);

                // Pie Data - Revenue (NET Company Income Only)
                setRevenuePieData([
                    { name: 'ขาย (Sales)', value: salesCompanyIncome },
                    { name: 'เช่า (Rentals)', value: rentalCompanyIncome },
                ]);

            }, [inputs]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setInputs(prev => ({
                    ...prev,
                    [name]: parseFloat(value) || 0
                }));
            };

            const toggleVatMode = () => {
                setInputs(prev => ({
                    ...prev,
                    vatMode: prev.vatMode === 'include' ? 'exclude' : 'include'
                }));
            }

            const formatCurrency = (num) => {
                return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', maximumFractionDigits: 0 }).format(num);
            };

            const COLORS = {
                chart: ['#0f172a', '#d97706', '#64748b', '#cbd5e1'],
                revenue: ['#3b82f6', '#f59e0b']
            };

            const staffRoles = [
                { id: 'Manager', label: 'ผู้จัดการ', rateKey: 'salaryManagerRate', countKey: 'salaryManagerCount' },
                { id: 'Sales', label: 'ทีมขาย', rateKey: 'salarySalesRate', countKey: 'salarySalesCount' },
                { id: 'Admin', label: 'แอดมิน', rateKey: 'salaryAdminRate', countKey: 'salaryAdminCount' },
                { id: 'Listing', label: 'Listing', rateKey: 'salaryListingRate', countKey: 'salaryListingCount' },
                { id: 'Content', label: 'Content', rateKey: 'salaryContentRate', countKey: 'salaryContentCount' },
            ];

            const capexItems = [
                { label: 'จดทะเบียน', name: 'capexRegistration' },
                { label: 'ตกแต่งสนง.', name: 'capexOffice' },
                { label: 'อุปกรณ์ IT', name: 'capexEquipment' },
                { label: 'ระบบ Tech', name: 'capexTech' },
                { label: 'เปิดตัว/ตลาด', name: 'capexLaunch' },
            ];

            return (
                <div className="bg-slate-50 min-h-screen font-sans text-slate-800 pb-10">
                
                {/* --- HERO HEADER --- */}
                <div className="bg-[#0f172a] text-white pt-8 pb-16 px-6 shadow-lg">
                    <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <div className="bg-amber-500 p-2 rounded-lg">
                                    <IconActivity className="text-white" size={24} />
                                </div>
                                <h1 className="text-3xl font-bold tracking-tight">Prime Axis Estate</h1>
                            </div>
                            <p className="text-slate-400 text-sm ml-14">Financial Strategy Simulator & Real-time Analysis</p>
                        </div>
                        
                        <div className="mt-6 md:mt-0 flex gap-4">
                            <div className="bg-slate-800/50 backdrop-blur-sm p-4 rounded-xl border border-slate-700">
                                <div className="text-xs text-slate-400 uppercase tracking-wider mb-1">กำไรสุทธิคาดการณ์ (ปี 1)</div>
                                <div className={`text-3xl font-bold ${results.annualNetProfit > 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                                    {formatCurrency(results.annualNetProfit)}
                                </div>
                            </div>
                            <div className="bg-slate-800/50 backdrop-blur-sm p-4 rounded-xl border border-slate-700 min-w-[140px]">
                                <div className="text-xs text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-1">
                                    <IconClock size={12} /> ระยะเวลาคืนทุน
                                </div>
                                <div className="text-3xl font-bold text-amber-400">
                                    {results.paybackPeriod === Infinity || results.paybackPeriod < 0 ? 'N/A' : `${results.paybackPeriod.toFixed(1)} เดือน`}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div className="max-w-7xl mx-auto px-4 sm:px-6 -mt-10 grid grid-cols-1 xl:grid-cols-12 gap-6">
                    
                    {/* --- LEFT SIDEBAR: CONTROLS (Col 3/12) --- */}
                    <div className="xl:col-span-3 space-y-5">

                        {/* NEW: CAPEX Inputs */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center gap-2">
                                <IconBriefcase size={16} className="text-indigo-600" />
                                <h3 className="font-bold text-slate-700 text-sm">งบลงทุนเริ่มต้น (CAPEX)</h3>
                            </div>
                            <div className="p-5 space-y-3">
                                <div>
                                    <label className="text-xs font-semibold text-slate-600 mb-1 block">ทุนจดทะเบียน</label>
                                    <input type="number" name="initialCapital" value={inputs.initialCapital} onChange={handleInputChange} 
                                        className="w-full bg-slate-50 border border-slate-200 rounded px-2 py-1.5 text-xs text-right focus:bg-white focus:ring-1 focus:ring-indigo-400 outline-none font-bold" />
                                </div>
                                <div className="h-px bg-slate-100 my-1"></div>
                                {capexItems.map((item) => (
                                    <div key={item.name} className="flex justify-between items-center">
                                        <label className="text-xs text-slate-500">{item.label}</label>
                                        <input type="number" name={item.name} value={inputs[item.name]} onChange={handleInputChange} 
                                            className="w-24 border border-slate-200 rounded px-2 py-1 text-xs text-right focus:ring-1 focus:ring-indigo-400 outline-none" />
                                    </div>
                                ))}
                                <div className="mt-3 pt-3 border-t border-slate-100">
                                    <div className="flex justify-between text-xs mb-1">
                                        <span className="text-slate-600">รวมจ่ายลงทุน:</span>
                                        <span className="font-semibold text-rose-600">{formatCurrency(results.totalCapex)}</span>
                                    </div>
                                    <div className="flex justify-between text-xs">
                                        <span className="text-slate-600 font-bold">เงินทุนหมุนเวียนคงเหลือ:</span>
                                        <span className="font-bold text-emerald-600">{formatCurrency(results.workingCapital)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* 1. Revenue Inputs */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <IconHome size={16} className="text-amber-600" />
                                    <h3 className="font-bold text-slate-700 text-sm">รายได้ (Revenue)</h3>
                                </div>
                                
                                {/* VAT Toggle */}
                                <button 
                                    onClick={toggleVatMode}
                                    className={`flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold transition-all ${
                                        inputs.vatMode === 'include' 
                                        ? 'bg-blue-100 text-blue-700 border border-blue-200' 
                                        : 'bg-orange-100 text-orange-700 border border-orange-200'
                                    }`}
                                >
                                    {inputs.vatMode === 'include' ? 'VAT ในตัว' : 'VAT แยก'}
                                    {inputs.vatMode === 'include' ? <IconToggleLeft size={14}/> : <IconToggleRight size={14}/>}
                                </button>
                            </div>
                            
                            <div className="p-5 space-y-6">
                                {/* Sales */}
                                <div>
                                    <div className="flex justify-between items-center mb-2">
                                        <label className="text-xs font-semibold text-slate-600">ยอดขาย (หลัง/เดือน)</label>
                                        <span className="text-xs font-mono bg-amber-50 text-amber-700 px-2 py-0.5 rounded border border-amber-100">{inputs.salesVolume}</span>
                                    </div>
                                    <input 
                                        type="range" name="salesVolume" min="0" max="10" step="0.5" 
                                        value={inputs.salesVolume} onChange={handleInputChange}
                                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-600"
                                    />
                                    <div className="mt-3 grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="text-[10px] text-slate-400 block mb-1">ราคาเฉลี่ย (บาท)</label>
                                            <input type="number" name="avgHousePrice" value={inputs.avgHousePrice} onChange={handleInputChange} 
                                                className="w-full border border-slate-200 rounded px-2 py-1.5 text-xs focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all" />
                                        </div>
                                        <div>
                                            <label className="text-[10px] text-slate-400 block mb-1">คอมมิชชั่น (%)</label>
                                            <input type="number" name="salesCommRate" value={inputs.salesCommRate} onChange={handleInputChange} 
                                                className="w-full border border-slate-200 rounded px-2 py-1.5 text-xs focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all" />
                                        </div>
                                    </div>
                                </div>

                                <div className="h-px bg-slate-100"></div>

                                {/* Rentals */}
                                <div>
                                    <div className="flex justify-between items-center mb-2">
                                        <label className="text-xs font-semibold text-slate-600">ยอดเช่า (เคส/เดือน)</label>
                                        <span className="text-xs font-mono bg-blue-50 text-blue-700 px-2 py-0.5 rounded border border-blue-100">{inputs.rentalVolume}</span>
                                    </div>
                                    <input 
                                        type="range" name="rentalVolume" min="0" max="20" step="1" 
                                        value={inputs.rentalVolume} onChange={handleInputChange}
                                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                    />
                                    <div className="mt-3 grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="text-[10px] text-slate-400 block mb-1">ค่าเช่าเฉลี่ย (บาท)</label>
                                            <input type="number" name="avgRentalPrice" value={inputs.avgRentalPrice} onChange={handleInputChange} 
                                                className="w-full border border-slate-200 rounded px-2 py-1.5 text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" />
                                        </div>
                                        <div>
                                            <label className="text-[10px] text-slate-400 block mb-1">คอมฯ (เดือน)</label>
                                            <input type="number" name="rentalCommMonths" value={inputs.rentalCommMonths} onChange={handleInputChange} 
                                                className="w-full border border-slate-200 rounded px-2 py-1.5 text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 2. Staff & Costs (UPDATED) */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center gap-2">
                                <IconUsers size={16} className="text-slate-600" />
                                <h3 className="font-bold text-slate-700 text-sm">ต้นทุน (Costs & Salaries)</h3>
                            </div>
                            <div className="p-4 space-y-3">
                                <div className="grid grid-cols-12 gap-2 text-[10px] text-slate-400 font-medium text-center pb-1 border-b border-slate-100">
                                    <div className="col-span-4 text-left pl-1">ตำแหน่ง</div>
                                    <div className="col-span-3">เงิน/คน</div>
                                    <div className="col-span-2">คน</div>
                                    <div className="col-span-3 text-right pr-1">รวม</div>
                                </div>
                                
                                {staffRoles.map((role) => (
                                    <div key={role.id} className="grid grid-cols-12 gap-2 items-center">
                                        <div className="col-span-4 text-xs font-medium text-slate-600">{role.label}</div>
                                        <div className="col-span-3">
                                            <input 
                                                type="number" name={role.rateKey} value={inputs[role.rateKey]} onChange={handleInputChange}
                                                className="w-full bg-slate-50 border border-slate-200 rounded px-1 py-1 text-xs text-center focus:bg-white outline-none"
                                            />
                                        </div>
                                        <div className="col-span-2">
                                            <input 
                                                type="number" name={role.countKey} value={inputs[role.countKey]} onChange={handleInputChange}
                                                className="w-full bg-slate-50 border border-slate-200 rounded px-1 py-1 text-xs text-center focus:bg-white outline-none"
                                            />
                                        </div>
                                        <div className="col-span-3 text-xs text-right font-bold text-slate-700">
                                            {formatCurrency(inputs[role.rateKey] * inputs[role.countKey])}
                                        </div>
                                    </div>
                                ))}

                                <div className="h-px bg-slate-100 my-2"></div>
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-xs font-semibold text-rose-600">งบการตลาด</label>
                                    <input type="number" name="marketingBudget" value={inputs.marketingBudget} onChange={handleInputChange} className="w-24 border border-rose-200 bg-rose-50 rounded px-2 py-1 text-xs text-right font-semibold text-rose-700 focus:ring-1 focus:ring-rose-400 outline-none" />
                                </div>
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-xs text-slate-600">ค่าเช่าออฟฟิศ</label>
                                    <input type="number" name="officeRent" value={inputs.officeRent} onChange={handleInputChange} className="w-24 border border-slate-200 bg-slate-50 rounded px-2 py-1 text-xs text-right focus:bg-white focus:ring-1 focus:ring-slate-400 outline-none" />
                                </div>
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-xs text-slate-600">Software/Misc</label>
                                    <input type="number" name="softwareCost" value={inputs.softwareCost} onChange={handleInputChange} className="w-24 border border-slate-200 bg-slate-50 rounded px-2 py-1 text-xs text-right focus:bg-white focus:ring-1 focus:ring-slate-400 outline-none" />
                                </div>
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-xs text-slate-600">ค่าใช้จ่ายอื่นๆ</label>
                                    <input type="number" name="otherExpenses" value={inputs.otherExpenses} onChange={handleInputChange} className="w-24 border border-slate-200 bg-slate-50 rounded px-2 py-1 text-xs text-right focus:bg-white focus:ring-1 focus:ring-slate-400 outline-none" />
                                </div>
                            </div>
                        </div>

                        {/* 3. Commission Structure Settings */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center gap-2">
                                <IconSettings size={16} className="text-slate-600" />
                                <h3 className="font-bold text-slate-700 text-sm">ปรับสัดส่วนค่าคอมฯ (%)</h3>
                            </div>
                            <div className="p-5 space-y-3">
                                <div className="flex justify-between items-center">
                                    <label className="text-xs text-amber-700 font-medium">ทีมขาย (Sales)</label>
                                    <div className="flex items-center gap-1">
                                        <input type="number" name="shareSales" value={inputs.shareSales} onChange={handleInputChange} className="w-14 border border-amber-200 bg-amber-50 rounded px-1 py-1 text-xs text-center font-bold text-amber-800" />
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-xs text-slate-600">ผู้จัดการ (Manager)</label>
                                    <div className="flex items-center gap-1">
                                        <input type="number" name="shareManager" value={inputs.shareManager} onChange={handleInputChange} className="w-14 border border-slate-200 bg-slate-50 rounded px-1 py-1 text-xs text-center" />
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-xs text-slate-600">Listing</label>
                                    <div className="flex items-center gap-1">
                                        <input type="number" name="shareListing" value={inputs.shareListing} onChange={handleInputChange} className="w-14 border border-slate-200 bg-slate-50 rounded px-1 py-1 text-xs text-center" />
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-xs text-slate-600">Admin</label>
                                    <div className="flex items-center gap-1">
                                        <input type="number" name="shareAdmin" value={inputs.shareAdmin} onChange={handleInputChange} className="w-14 border border-slate-200 bg-slate-50 rounded px-1 py-1 text-xs text-center" />
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-xs text-slate-600">Content</label>
                                    <div className="flex items-center gap-1">
                                        <input type="number" name="shareContent" value={inputs.shareContent} onChange={handleInputChange} className="w-14 border border-slate-200 bg-slate-50 rounded px-1 py-1 text-xs text-center" />
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                <div className="h-px bg-slate-100 my-2"></div>
                                <div className="flex justify-between items-center">
                                    <label className="text-xs font-bold text-slate-800">บริษัท (Auto)</label>
                                    <div className="flex items-center gap-1">
                                        <div className="w-14 bg-slate-100 border border-slate-200 rounded px-1 py-1 text-xs text-center font-bold text-slate-700">
                                            {results.companySharePercent.toFixed(1)}
                                        </div>
                                        <span className="text-xs text-slate-400">%</span>
                                    </div>
                                </div>
                                {results.companySharePercent < 0 && (
                                    <p className="text-[10px] text-red-500 text-right mt-1">สัดส่วนเกิน 100%!</p>
                                )}
                            </div>
                        </div>

                    </div>

                    {/* --- MIDDLE: BREAKDOWNS (Col 5/12) --- */}
                    <div className="xl:col-span-5 space-y-6">
                        
                        {/* Commission Breakdown Card */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                <h4 className="font-bold text-slate-800 text-sm flex items-center gap-2">
                                    <IconFileText size={16} className="text-slate-500" /> 
                                    เส้นทางของเงิน (Revenue Flow)
                                </h4>
                                <span className="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded-full">รายเดือน</span>
                            </div>
                            
                            <div className="p-6">
                                {/* Visual Flow */}
                                <div className="relative pl-4 border-l-2 border-slate-100 space-y-6">
                                    
                                    {/* 1. Total Gross */}
                                    <div className="relative">
                                        <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-slate-300 ring-4 ring-white"></div>
                                        <div className="flex justify-between items-end mb-1">
                                            <span className="text-sm font-semibold text-slate-600">1. ยอดรับรวม ({inputs.vatMode === 'include' ? '100% รวม VAT' : 'Base + 7%'})</span>
                                            <span className="text-lg font-bold text-slate-800">{formatCurrency(results.totalGross)}</span>
                                        </div>
                                        <div className="text-xs text-slate-400">เงินโอนจากลูกค้าทั้งหมด</div>
                                    </div>

                                    {/* 2. VAT Deduction */}
                                    <div className="relative">
                                        <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-rose-200 ring-4 ring-white"></div>
                                        <div className="flex justify-between items-center p-3 bg-rose-50 rounded-lg border border-rose-100">
                                            <span className="text-xs font-medium text-rose-700 flex items-center gap-2">
                                                <IconTrendingUp size={14} className="rotate-180" /> หัก: ภาษีมูลค่าเพิ่ม (VAT 7%)
                                            </span>
                                            <span className="text-sm font-bold text-rose-700">({formatCurrency(results.vatAmount)})</span>
                                        </div>
                                    </div>

                                    {/* 3. Net Revenue */}
                                    <div className="relative">
                                        <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-blue-500 ring-4 ring-white"></div>
                                        <div className="flex justify-between items-end mb-1">
                                            <span className="text-sm font-bold text-blue-900">2. ยอดสุทธิ (Net Revenue)</span>
                                            <span className="text-lg font-bold text-blue-900">{formatCurrency(results.netRevenue)}</span>
                                        </div>
                                        <div className="text-xs text-slate-400 mb-3">ยอดหลังถอด VAT เพื่อแบ่งสรรปันส่วน</div>
                                        
                                        {/* Distribution Bars */}
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-slate-500">บริษัท ({results.companySharePercent}%)</span>
                                                    <span className="font-bold text-slate-700">{formatCurrency(results.distCompany)}</span>
                                                </div>
                                                <div className="w-full bg-slate-200 rounded-full h-1.5">
                                                    <div className="bg-slate-800 h-1.5 rounded-full" style={{width: `${Math.max(0, results.companySharePercent)}%`}}></div>
                                                </div>
                                            </div>
                                            <div className="bg-amber-50 p-2 rounded border border-amber-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-amber-700">ทีมขาย ({inputs.shareSales}%)</span>
                                                    <span className="font-bold text-amber-700">{formatCurrency(results.distSales)}</span>
                                                </div>
                                                <div className="w-full bg-amber-200 rounded-full h-1.5">
                                                    <div className="bg-amber-500 h-1.5 rounded-full" style={{width: `${inputs.shareSales}%`}}></div>
                                                </div>
                                            </div>
                                            <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-slate-500">Manager ({inputs.shareManager}%)</span>
                                                    <span className="font-bold text-slate-700">{formatCurrency(results.distManager)}</span>
                                                </div>
                                                <div className="w-full bg-slate-200 rounded-full h-1.5">
                                                    <div className="bg-indigo-400 h-1.5 rounded-full" style={{width: '60%'}}></div>
                                                </div>
                                            </div>
                                            <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-slate-500">Listing ({inputs.shareListing}%)</span>
                                                    <span className="font-bold text-slate-700">{formatCurrency(results.distListing)}</span>
                                                </div>
                                                <div className="w-full bg-slate-200 rounded-full h-1.5">
                                                    <div className="bg-blue-400 h-1.5 rounded-full" style={{width: '60%'}}></div>
                                                </div>
                                            </div>
                                            <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-slate-500">Admin ({inputs.shareAdmin}%)</span>
                                                    <span className="font-bold text-slate-700">{formatCurrency(results.distAdmin)}</span>
                                                </div>
                                                <div className="w-full bg-slate-200 rounded-full h-1.5">
                                                    <div className="bg-purple-400 h-1.5 rounded-full" style={{width: '60%'}}></div>
                                                </div>
                                            </div>
                                            <div className="bg-slate-50 p-2 rounded border border-slate-100">
                                                <div className="flex justify-between text-xs mb-1">
                                                    <span className="text-slate-500">Content ({inputs.shareContent}%)</span>
                                                    <span className="font-bold text-slate-700">{formatCurrency(results.distContent)}</span>
                                                </div>
                                                <div className="w-full bg-slate-200 rounded-full h-1.5">
                                                    <div className="bg-pink-400 h-1.5 rounded-full" style={{width: '60%'}}></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* 4. Company Final Calculation (NEW) */}
                                    <div className="relative pt-4 border-t border-slate-100 mt-4">
                                        <div className="absolute -left-[21px] top-6 w-3 h-3 rounded-full bg-emerald-500 ring-4 ring-white"></div>
                                        <div className="space-y-2">
                                            <div className="flex justify-between items-center text-xs">
                                                <span className="text-slate-600">รายรับเข้าบริษัท (Company Share):</span>
                                                <span className="font-semibold text-slate-800">{formatCurrency(results.distCompany)}</span>
                                            </div>
                                            <div className="flex justify-between items-center text-xs">
                                                <span className="text-red-500">- หัก: ค่าใช้จ่ายรวม (Total Expenses):</span>
                                                <span className="font-semibold text-red-500">({formatCurrency(results.totalExpenses)})</span>
                                            </div>
                                            <div className="flex justify-between items-center pt-2 border-t border-dashed border-slate-200">
                                                <span className="text-sm font-bold text-emerald-700">= กำไรสุทธิต่อเดือน (Monthly Net Profit):</span>
                                                <span className={`text-lg font-bold ${results.monthlyEBT > 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                                                    {formatCurrency(results.monthlyEBT)}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        {/* Corporate Tax Table */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                <h4 className="font-bold text-slate-800 text-sm flex items-center gap-2">
                                    <IconBuilding2 size={16} className="text-slate-500" /> 
                                    ภาษีนิติบุคคล (Corporate Tax)
                                </h4>
                                <div className="text-xs font-semibold bg-emerald-100 text-emerald-700 px-2 py-1 rounded">
                                    กำไรสุทธิก่อนภาษี: {formatCurrency(results.annualEBT)}
                                </div>
                            </div>

                            <div className="p-0">
                                <table className="w-full text-sm">
                                    <thead className="bg-slate-50 text-slate-500 text-xs uppercase">
                                        <tr>
                                            <th className="py-3 pl-6 text-left font-medium">ช่วงกำไร (Net Profit)</th>
                                            <th className="py-3 text-center font-medium">อัตรา</th>
                                            <th className="py-3 pr-6 text-right font-medium">ภาษีที่ต้องจ่าย</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {results.taxDetails.map((item, index) => (
                                            <tr key={index} className="hover:bg-slate-50/50 transition-colors">
                                                <td className="py-3 pl-6 text-slate-600">{item.tier}</td>
                                                <td className="py-3 text-center">
                                                    <span className="bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-xs font-bold">{item.rate}</span>
                                                </td>
                                                <td className="py-3 pr-6 text-right font-medium text-slate-800">{formatCurrency(item.tax)}</td>
                                            </tr>
                                        ))}
                                        <tr className="bg-slate-50/80">
                                            <td className="py-3 pl-6 font-bold text-slate-800" colSpan="2">รวมภาษีทั้งสิ้น (Total Tax)</td>
                                            <td className="py-3 pr-6 text-right font-bold text-rose-600">{formatCurrency(results.totalTax)}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    {/* --- RIGHT SIDEBAR: CHARTS & TABLES (Col 4/12) --- */}
                    <div className="xl:col-span-4 space-y-6">
                        
                        {/* New: Revenue Pie Chart */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5 h-64 flex flex-col">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-2">
                                <IconPieChart size={16} className="text-slate-500" /> สัดส่วนรายได้สุทธิเข้าบริษัท (Net Income Mix)
                            </h4>
                            <div className="flex-1 flex items-center">
                                <div className="w-1/2 h-full relative">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie
                                                data={revenuePieData}
                                                cx="50%"
                                                cy="50%"
                                                innerRadius={40}
                                                outerRadius={55}
                                                paddingAngle={5}
                                                dataKey="value"
                                                stroke="none"
                                            >
                                                {revenuePieData.map((entry, index) => (
                                                    <Cell key={`cell-rev-${index}`} fill={COLORS.revenue[index % COLORS.revenue.length]} />
                                                ))}
                                            </Pie>
                                            <Tooltip formatter={(val) => formatCurrency(val)} />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                                <div className="w-1/2 pl-2 flex flex-col justify-center space-y-3">
                                    {revenuePieData.map((entry, index) => (
                                        <div key={index} className="flex flex-col">
                                            <div className="flex items-center gap-2 mb-0.5">
                                                <div className="w-2 h-2 rounded-full" style={{backgroundColor: COLORS.revenue[index]}}></div>
                                                <span className="text-xs text-slate-500">{entry.name}</span>
                                            </div>
                                            <div className="pl-4">
                                                <span className="text-sm font-bold text-slate-700 block leading-tight">{formatCurrency(entry.value)}</span>
                                                <span className="text-[10px] text-slate-400 font-medium">{((entry.value/results.distCompany)*100).toFixed(1)}%</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Pie Chart Expense */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5 h-80 flex flex-col">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-2">
                                <IconPieChart size={16} className="text-slate-500" /> สัดส่วนค่าใช้จ่าย (Expenses)
                            </h4>
                            <div className="flex-1 flex items-center">
                                <div className="w-1/2 h-full relative">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie
                                                data={expensePieData}
                                                cx="50%"
                                                cy="50%"
                                                innerRadius={45}
                                                outerRadius={65}
                                                paddingAngle={5}
                                                dataKey="value"
                                                stroke="none"
                                            >
                                                {expensePieData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={COLORS.chart[index % COLORS.chart.length]} />
                                                ))}
                                            </Pie>
                                            <Tooltip formatter={(val) => formatCurrency(val)} />
                                        </PieChart>
                                    </ResponsiveContainer>
                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <span className="text-[10px] font-bold text-slate-400">Total</span>
                                    </div>
                                </div>
                                <div className="w-1/2 pl-2 flex flex-col justify-center space-y-2 overflow-y-auto max-h-full custom-scrollbar pr-1">
                                    {expensePieData.map((entry, index) => (
                                        <div key={index} className="flex flex-col">
                                            <div className="flex items-center gap-2 mb-0.5">
                                                <div className="w-2 h-2 rounded-full flex-shrink-0" style={{backgroundColor: COLORS.chart[index % COLORS.chart.length]}}></div>
                                                <span className="text-xs text-slate-500 truncate">{entry.name}</span>
                                            </div>
                                            <div className="pl-4">
                                                <span className="text-sm font-bold text-slate-700 block leading-tight">{formatCurrency(entry.value)}</span>
                                                <span className="text-[10px] text-slate-400 font-medium">{((entry.value/Math.max(1, results.totalExpenses))*100).toFixed(1)}%</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Break Even Summary */}
                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-lg p-6 text-white relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-10">
                                <IconRefreshCw size={100} />
                            </div>
                            <h4 className="font-bold mb-4 text-sm flex items-center gap-2 opacity-90">
                                <IconRefreshCw size={16} /> จุดคุ้มทุน (Break-Even)
                            </h4>
                            
                            <div className="mb-6">
                                <div className="text-xs text-slate-300 mb-1">รายได้รวมขั้นต่ำที่ต้องการ/เดือน</div>
                                <div className="text-3xl font-bold text-amber-400">{formatCurrency(results.breakEvenPoint)}</div>
                            </div>

                            <div className="space-y-3 text-sm relative z-10">
                                <div className="flex justify-between items-center bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                    <span className="text-slate-300">ขายบ้าน:</span>
                                    <span className="font-semibold">{Math.ceil(results.breakEvenPoint / inputs.avgHousePrice)} หลัง</span>
                                </div>
                                <div className="flex justify-between items-center bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                    <span className="text-slate-300">เช่าบ้าน:</span>
                                    <span className="font-semibold">{Math.ceil(results.breakEvenPoint / (inputs.avgRentalPrice * inputs.rentalCommMonths))} เคส</span>
                                </div>
                            </div>
                        </div>

                        {/* Cash Flow Table */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col h-[400px]">
                            <div className="px-5 py-3 border-b border-slate-100 bg-slate-50/50">
                                <div className="flex justify-between items-center mb-2">
                                    <h4 className="font-bold text-slate-700 text-sm flex items-center gap-2">
                                        <IconTable size={16} className="text-slate-500" /> กระแสเงินสด 12 เดือน
                                    </h4>
                                    <div className="flex items-center gap-2 bg-slate-100 rounded-lg p-1">
                                        <IconGrowth size={14} className="text-emerald-600" />
                                        <select 
                                            name="growthRate" 
                                            value={inputs.growthRate} 
                                            onChange={handleInputChange}
                                            className="bg-transparent text-xs font-bold text-slate-700 outline-none cursor-pointer"
                                        >
                                            <option value="0">คงที่ (0%)</option>
                                            <option value="5">โต 5%/เดือน</option>
                                            <option value="10">โต 10%/เดือน</option>
                                            <option value="20">โต 20%/เดือน</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="overflow-auto flex-1 p-0 custom-scrollbar">
                                <table className="w-full text-xs border-collapse text-right">
                                    <thead className="bg-slate-100 sticky top-0 z-10 text-slate-500 font-medium">
                                        <tr>
                                            <th className="py-2 px-1 text-center border-b">เดือน</th>
                                            <th className="py-2 px-1 border-b">รายได้</th>
                                            <th className="py-2 px-1 border-b">ค่าใช้จ่าย</th>
                                            <th className="py-2 px-1 border-b">กำไร (EBT)</th>
                                            <th className="py-2 px-2 border-b text-blue-800">เงินสดสะสม</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-50">
                                        {/* Start Row */}
                                        <tr className="bg-amber-50/50 text-slate-500 italic">
                                            <td className="py-2 px-1 text-center">Start</td>
                                            <td className="py-2 px-1">-</td>
                                            <td className="py-2 px-1">-</td>
                                            <td className="py-2 px-1">-</td>
                                            <td className="py-2 px-2 font-medium">{formatCurrency(results.workingCapital)}</td>
                                        </tr>
                                        {/* Monthly Rows (1-12) */}
                                        {cashFlowData.map((row, index) => (
                                            <tr key={index} className={`hover:bg-slate-50 transition-colors`}>
                                                <td className="py-2 px-1 text-center text-slate-400">{row.month}</td>
                                                <td className="py-2 px-1 text-emerald-600 font-medium">{formatCurrency(row.revenue)}</td>
                                                <td className="py-2 px-1 text-rose-500">{formatCurrency(row.expenses)}</td>
                                                <td className="py-2 px-1 text-slate-700">{formatCurrency(row.net)}</td>
                                                <td className="py-2 px-2 font-bold text-blue-900">{formatCurrency(row.cumulative)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                    <tfoot className="bg-slate-100 font-bold border-t-2 border-slate-300">
                                        <tr>
                                            <td className="py-2 px-1 text-center">รวมปี 1</td>
                                            <td className="py-2 px-1 text-emerald-700">{formatCurrency(results.year1RevenueSum)}</td>
                                            <td className="py-2 px-1 text-rose-600">{formatCurrency(results.year1ExpenseSum)}</td>
                                            <td className="py-2 px-1 text-blue-700">{formatCurrency(results.annualEBT)}</td>
                                            <td className="py-2 px-2">-</td> 
                                        </tr>
                                        <tr className="bg-slate-50 text-rose-600">
                                            <td colSpan="3" className="py-2 px-2 text-right">หัก: ภาษีนิติบุคคลสิ้นปี</td>
                                            <td className="py-2 px-1 border-b">({formatCurrency(results.totalTax)})</td>
                                            <td></td>
                                        </tr>
                                         <tr className="bg-blue-50 text-blue-900 text-sm">
                                            <td colSpan="3" className="py-2 px-2 text-right">เงินสดสะสมสุทธิ (สิ้นปี)</td>
                                            <td colSpan="2" className="py-2 px-2 text-right">{formatCurrency(results.finalCashBalance)}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                {/* --- 5-YEAR PROJECTION SECTION (NEW CARD) --- */}
                <div className="max-w-7xl mx-auto px-4 sm:px-6 mt-6 mb-10">
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="px-6 py-4 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center bg-indigo-900 text-white">
                            <div>
                                <h3 className="font-bold text-lg flex items-center gap-2">
                                    <IconTrendingUp size={20} className="text-amber-400" /> 
                                    ประมาณการกระแสเงินสด 5 ปี (5-Year Projection)
                                </h3>
                                <p className="text-xs text-indigo-200 mt-1">วางแผนระยะยาวเพื่อการเติบโตอย่างยั่งยืน</p>
                            </div>
                            <div className="flex items-center gap-2 bg-indigo-800/50 p-2 rounded-lg mt-3 md:mt-0">
                                <label className="text-xs font-medium text-indigo-200">อัตราเติบโตรายปี (Yearly Growth):</label>
                                <select 
                                    name="annualGrowthRate" 
                                    value={inputs.annualGrowthRate} 
                                    onChange={handleInputChange}
                                    className="bg-indigo-950 border border-indigo-700 text-white text-sm rounded px-2 py-1 outline-none cursor-pointer hover:bg-indigo-900"
                                >
                                    <option value="0">คงที่ (0%)</option>
                                    <option value="5">5% ต่อปี</option>
                                    <option value="10">10% ต่อปี</option>
                                    <option value="15">15% ต่อปี</option>
                                    <option value="20">20% ต่อปี</option>
                                    <option value="30">30% ต่อปี</option>
                                </select>
                            </div>
                        </div>
                        
                        <div className="p-6 overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-200">
                                    <tr>
                                        <th className="px-4 py-3">ปีที่ (Year)</th>
                                        <th className="px-4 py-3 text-right">รายได้สุทธิ (Net Revenue)</th>
                                        <th className="px-4 py-3 text-right">ค่าใช้จ่าย (Expenses)</th>
                                        <th className="px-4 py-3 text-right">กำไรก่อนภาษี (EBT)</th>
                                        <th className="px-4 py-3 text-right">ภาษี (Tax)</th>
                                        <th className="px-4 py-3 text-right text-emerald-600 font-bold">กำไรสุทธิ (Net Profit)</th>
                                        <th className="px-4 py-3 text-right text-blue-800 font-bold">เงินสดสะสม (Cash End)</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {fiveYearData.map((year, index) => (
                                        <tr key={year.year} className="hover:bg-slate-50 transition-colors">
                                            <td className="px-4 py-3 font-medium text-slate-700">
                                                ปีที่ {year.year}
                                                {index === 0 && <span className="ml-2 text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-500">ฐานปัจจุบัน</span>}
                                            </td>
                                            <td className="px-4 py-3 text-right">{formatCurrency(year.revenue)}</td>
                                            <td className="px-4 py-3 text-right text-slate-500">{formatCurrency(year.expenses)}</td>
                                            <td className="px-4 py-3 text-right font-medium">{formatCurrency(year.ebt)}</td>
                                            <td className="px-4 py-3 text-right text-rose-500">({formatCurrency(year.tax)})</td>
                                            <td className="px-4 py-3 text-right font-bold text-emerald-600 bg-emerald-50/30">{formatCurrency(year.netProfit)}</td>
                                            <td className="px-4 py-3 text-right font-bold text-blue-900 bg-blue-50/30">{formatCurrency(year.cashEnd)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            <div className="mt-4 text-xs text-slate-400 text-right">
                                *สมมติฐาน: รายได้เติบโตตามอัตราที่เลือก, ค่าใช้จ่ายเพิ่มขึ้นตามเงินเฟ้อ 5% ต่อปี
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinancialDashboard />);
    </script>
</body>
</html>
